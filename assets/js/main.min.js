window.AppTracker={csrfToken:null,init:function(){this.setupAjax(),this.setupTooltips(),this.setupConfirmDialogs(),this.setupFormValidation()},setupAjax:function(){const e=document.querySelector('meta[name="csrf-token"]');e&&(this.csrfToken=e.getAttribute("content"));const t=window.fetch;window.fetch=function(e,n={}){return n.headers=n.headers||{},AppTracker.csrfToken&&n.method&&"GET"!==n.method.toUpperCase()&&(n.headers["X-CSRF-Token"]=AppTracker.csrfToken),t(e,n)}},setupTooltips:function(){document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(function(e){new bootstrap.Tooltip(e)})},setupConfirmDialogs:function(){document.addEventListener("click",function(e){const t=e.target.closest("[data-confirm]");if(t){const n=t.getAttribute("data-confirm");confirm(n)||(e.preventDefault(),e.stopPropagation())}})},setupFormValidation:function(){document.querySelectorAll(".needs-validation").forEach(function(e){e.addEventListener("submit",function(t){e.checkValidity()||(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")})})},showLoading:function(e){const t=document.createElement("span");t.className="spinner me-2",t.setAttribute("data-loading-spinner","true"),"string"==typeof e&&(e=document.querySelector(e)),e&&(e.insertBefore(t,e.firstChild),e.disabled=!0)},hideLoading:function(e){"string"==typeof e&&(e=document.querySelector(e));if(e){const t=e.querySelector("[data-loading-spinner]");t&&t.remove(),e.disabled=!1}},showToast:function(e,t="info"){const n=this.getOrCreateToastContainer(),o="toast-"+Date.now(),r=`<div id="${o}" class="toast align-items-center text-white bg-${"error"===t?"danger":t} border-0" role="alert"><div class="d-flex"><div class="toast-body">${e}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div></div>`;n.insertAdjacentHTML("beforeend",r);const a=document.getElementById(o),c=new bootstrap.Toast(a,{delay:5e3});c.show(),a.addEventListener("hidden.bs.toast",function(){a.remove()})},getOrCreateToastContainer:function(){let e=document.querySelector(".toast-container");return e||(e=document.createElement("div"),e.className="toast-container position-fixed top-0 end-0 p-3",e.style.zIndex="1070",document.body.appendChild(e)),e},formatDate:function(e){if(!e)return"Not set";return new Date(e).toLocaleDateString()},formatDateTime:function(e){if(!e)return"Not set";return new Date(e).toLocaleString()},daysBetween:function(e,t){return Math.round(Math.abs((new Date(e)-new Date(t))/864e5))},debounce:function(e,t){let n;return function(...o){const r=()=>{clearTimeout(n),e(...o)};clearTimeout(n),n=setTimeout(r,t)}}},window.ProjectManager={loadProject:function(e,t){fetch(`/juniata/api/projects.php?id=${e}`).then(e=>e.json()).then(e=>{t&&t(e)}).catch(e=>{console.error("Error loading project:",e),AppTracker.showToast("Error loading project data","error")})},updateStatus:function(e,t,n){AppTracker.showLoading("#status-btn-"+e),fetch("/juniata/api/projects.php",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,status:t})}).then(e=>e.json()).then(e=>{e.success?(AppTracker.showToast("Project status updated","success"),n&&n(e)):AppTracker.showToast(e.message||"Error updating status","error")}).catch(e=>{console.error("Error updating status:",e),AppTracker.showToast("Error updating project status","error")}).finally(()=>{AppTracker.hideLoading("#status-btn-"+e)})}},window.TaskManager={loadTask:function(e,t){fetch(`/juniata/api/tasks.php?id=${e}`).then(e=>e.json()).then(e=>{t&&t(e)}).catch(e=>{console.error("Error loading task:",e),AppTracker.showToast("Error loading task data","error")})},updateStatus:function(e,t,n){fetch("/juniata/api/tasks.php",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,status:t})}).then(e=>e.json()).then(e=>{e.success?(AppTracker.showToast("Task status updated","success"),n&&n(e)):AppTracker.showToast(e.message||"Error updating status","error")}).catch(e=>{console.error("Error updating status:",e),AppTracker.showToast("Error updating task status","error")})}},window.SearchManager={init:function(){document.querySelectorAll("[data-search]").forEach(e=>{const t=AppTracker.debounce(this.performSearch.bind(this),300);e.addEventListener("input",t)}),document.querySelectorAll("[data-filter]").forEach(e=>{e.addEventListener("change",this.performSearch.bind(this))})},performSearch:function(){const e=document.querySelector("[data-search]")?.value||"",t={};document.querySelectorAll("[data-filter]").forEach(e=>{const n=e.getAttribute("data-filter"),o=e.value;o&&(t[n]=o)}),this.updateResults(e,t)},updateResults:function(e,t){const n=new URLSearchParams;e&&n.append("search",e),Object.keys(t).forEach(e=>{t[e]&&n.append(e,t[e])});const o=window.location.pathname+"?"+n.toString();window.history.replaceState({},"",o),window.location.reload()}},window.CalendarManager={currentDate:new Date,init:function(){this.renderCalendar(),this.setupEventHandlers()},renderCalendar:function(){const e=document.querySelector(".calendar-grid");if(!e)return;const t=this.currentDate.getFullYear(),n=this.currentDate.getMonth(),o=this.currentDate.toLocaleDateString("en-US",{month:"long",year:"numeric"});document.querySelector(".calendar-month").textContent=o,e.innerHTML="";["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(t=>{const n=document.createElement("div");n.className="calendar-day-header",n.textContent=t,e.appendChild(n)});const r=new Date(t,n,1).getDay(),a=new Date(t,n+1,0).getDate();for(let t=0;t<r;t++){const t=document.createElement("div");t.className="calendar-day other-month",e.appendChild(t)}for(let o=1;o<=a;o++){const a=document.createElement("div");a.className="calendar-day";const c=new Date;t===c.getFullYear()&&n===c.getMonth()&&o===c.getDate()&&a.classList.add("today"),a.innerHTML=`<div class="calendar-day-number">${o}</div>`,a.addEventListener("click",()=>this.onDayClick(t,n,o)),e.appendChild(a)}},setupEventHandlers:function(){document.querySelector(".btn-prev-month")?.addEventListener("click",()=>{this.currentDate.setMonth(this.currentDate.getMonth()-1),this.renderCalendar()}),document.querySelector(".btn-next-month")?.addEventListener("click",()=>{this.currentDate.setMonth(this.currentDate.getMonth()+1),this.renderCalendar()})},onDayClick:function(e,t,n){const o=`${e}-${String(t+1).padStart(2,"0")}-${String(n).padStart(2,"0")}`;console.log("Day clicked:",o)}},document.addEventListener("DOMContentLoaded",function(){AppTracker.init(),SearchManager.init(),document.querySelector(".calendar-grid")&&CalendarManager.init()}),window.App={Tracker:AppTracker,ProjectManager:ProjectManager,TaskManager:TaskManager,SearchManager:SearchManager,CalendarManager:CalendarManager};